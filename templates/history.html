{% extends "base.html" %}
{% block title %}Prediction History | JobAI{% endblock %}

{% block content %}

<style>
  /* ================= TABLE ================= */
  .history-table table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 16px;
  }

  .history-table th {
    font-size: 13px;
    font-weight: 600;
    color: var(--text-muted);
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid var(--border-soft);
  }

  .history-table td {
    padding: 12px;
    font-size: 14px;
    border-bottom: 1px solid var(--border-soft);
  }

  .history-table tbody tr:hover {
    background: rgba(255,255,255,0.04);
  }

  /* ================= BADGES ================= */
  .badge {
    padding: 6px 12px;
    border-radius: 999px;
    font-size: 12px;
    font-weight: 600;
  }

  .badge.high {
    background: rgba(34,197,94,0.2);
    color: #22c55e;
  }

  .badge.medium {
    background: rgba(245,158,11,0.2);
    color: #f59e0b;
  }

  .badge.low {
    background: rgba(239,68,68,0.2);
    color: #ef4444;
  }

  /* ================= META ================= */
  .history-meta {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 12px;
    margin-bottom: 14px;
  }

  .history-meta p {
    font-size: 13px;
    color: var(--text-muted);
  }
</style>

<!-- ================= HEADER ================= -->
<div class="dashboard-header fade-in">
  <h1>Prediction History</h1>
  <p class="text-muted">
    Audit trail of job demand predictions generated by JobAI
  </p>
</div>

<section class="panel fade-in history-table">

{% if predictions and predictions|length > 0 %}

<div class="history-meta">
  <p>
    Track how job demand, confidence, and inputs change over time.
  </p>
  <p>
    Total records: <b>{{ predictions|length }}</b>
  </p>
</div>

<table>
  <thead>
    <tr>
      <th>#</th>
      <th>Job Role</th>
      <th>Location</th>
      <th>Experience</th>
      <th>Skills</th>
      <th>Demand</th>
      <th>Confidence</th>
      <th>Date</th>
    </tr>
  </thead>

  <tbody>
    {% for p in predictions %}
    <tr>
      <td>{{ loop.index }}</td>

      <td>{{ p.jobtitle | title if p.jobtitle else "-" }}</td>
      <td>{{ p.location | title if p.location else "-" }}</td>
      <td>{{ p.experience_level if p.experience_level else "-" }}</td>
      <td>{{ p.skill_count if p.skill_count is not none else "-" }}</td>

      <td>
        {% if p.demand == "High" %}
          <span class="badge high">High</span>
        {% elif p.demand == "Medium" %}
          <span class="badge medium">Medium</span>
        {% else %}
          <span class="badge low">Low</span>
        {% endif %}
      </td>

      <td>{{ p.confidence }}%</td>

      <td>
        {{ p.created_at[:19].replace("T"," ") if p.created_at else "-" }}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% else %}

<p class="text-muted">
  No prediction records found yet.<br>
  Run a prediction from the dashboard to generate history.
</p>

{% endif %}

</section>

{% endblock %}
